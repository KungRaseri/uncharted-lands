# Environment Variables Setup

This document explains all environment variables used in the Uncharted Lands game server.

## Quick Start

```bash
# Copy the example file
cp .env.example .env

# Edit with your values
nano .env  # or use your preferred editor
```

## Required Variables

### PORT

**Required for:** Server binding

Port number the game server will listen on.

```env
PORT=3001
```

Default: `3001` (or `8080` if not set)

### HOST

**Required for:** Server binding

Network interface to bind to.

```env
HOST=0.0.0.0      # Listen on all interfaces (production)
HOST=localhost    # Local development only
HOST=127.0.0.1    # Local development only
```

Default: `0.0.0.0`

### DATABASE_URL

**Required for:** Database connections

PostgreSQL connection string (shared with client).

```env
DATABASE_URL="postgresql://postgres:password@localhost:5432/uncharted_lands"
```

> **Important:** The server uses the **same database** as the client. Migrations are managed by the client project.

## Optional Variables

### SENTRY_DSN

**Required for:** Error tracking and monitoring

Get this from your [Sentry project settings](https://sentry.io/settings/).

```env
SENTRY_DSN="https://your-key@sentry.io/project-id"
```

Set to `"disabled"` to disable error tracking in development.

### SENTRY_AUTH_TOKEN

**Required for:** Source map uploads during build

Only needed when deploying or in CI pipelines.

```env
SENTRY_AUTH_TOKEN="your-auth-token"
```

### CORS_ORIGINS

**Required for:** Socket.IO CORS configuration

Comma-separated list of allowed origins.

```env
CORS_ORIGINS=http://localhost:5173,https://uncharted-lands.vercel.app
```

### TICK_RATE

**Required for:** Game loop speed

Number of game ticks per second.

```env
TICK_RATE=60  # Default: 60 ticks per second for smooth gameplay
```

### MAX_PLAYERS_PER_WORLD

**Required for:** Player limits

Maximum number of concurrent players per world.

```env
MAX_PLAYERS_PER_WORLD=100
```

## Automatically Set Variables

### NODE_ENV

- `development` - Local development
- `production` - Production builds

## Environment-Specific Configurations

### Local Development

```env
PORT=3001
HOST=localhost
DATABASE_URL="postgresql://postgres:password@localhost:5432/uncharted_lands"
SENTRY_DSN="disabled"
CORS_ORIGINS=http://localhost:5173
```

### Production

```env
PORT=3001
HOST=0.0.0.0
DATABASE_URL="postgresql://[production-database-url]"
SENTRY_DSN="https://your-key@sentry.io/project-id"
CORS_ORIGINS=https://uncharted-lands.vercel.app,https://www.your-domain.com
TICK_RATE=60
MAX_PLAYERS_PER_WORLD=100
```

## Integration with Client

The server and client share:

1. **Database** - Same PostgreSQL instance
2. **Database Schema** - Managed by Drizzle ORM in `src/db/schema.ts`
3. **Environment Variables** - Both need `DATABASE_URL`

### Setup Order

1. Set up server `.env` (includes database config)
2. Run database migrations from server: `npm run db:push`
3. Set up client `.env` for API access
4. Start server: `npm run dev`
5. Start client: `cd ../client && npm run dev`

### Database Management

```bash
# From server directory
npm run db:generate  # Generate migration from schema.ts changes
npm run db:push      # Apply schema to database
npm run db:studio    # Open Drizzle Studio in browser
```

**Note**: The client does NOT directly access the database. All database operations go through the server's REST API or Socket.IO events.

## Security Best Practices

1. ✅ **Never commit `.env` files** - They contain secrets
2. ✅ **Always use `.env.example`** - For documenting required variables
3. ✅ **Use different values per environment** - Don't share production secrets
4. ✅ **Restrict CORS_ORIGINS** - Only allow trusted domains
5. ✅ **Use strong database passwords** - Especially in production

## Troubleshooting

### "Can't connect to database"

- Check `DATABASE_URL` matches client configuration
- Ensure PostgreSQL is running
- Verify server can reach database host

### "CORS errors in browser"

- Check `CORS_ORIGINS` includes your client URL
- Ensure no trailing slashes in URLs
- Verify protocol (http vs https) matches

### "Server won't start on PORT"

- Check if port is already in use: `netstat -an | findstr :3001`
- Try a different port
- Ensure no other process is using it

## See Also

- [Server Architecture](../docs/development/architecture.md)
- [WebSocket API](../docs/development/api.md)
- [Client .env.md](../../client/.env.md)
